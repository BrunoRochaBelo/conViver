<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>conViver - Ocorrências</title>
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/ocorrencias.css">
</head>

<body>
    <header class="cv-header">
        <div class="cv-container cv-header__container">
            <h1 class="cv-header__title">conViver</h1>
            <nav id="mainNav"></nav>
            <button id="userMenuButton" class="user-avatar"></button>
        </div>
    </header>
    <div id="userMenuModal" class="cv-modal user-menu-modal">
        <div class="cv-modal-content">
            <header class="cv-modal-header">
                <button type="button" class="cv-modal-close" aria-label="Fechar" id="userMenuClose">&times;</button>
            </header>
            <div class="cv-modal-body">
                <ul class="user-menu-list">
                <li><button id="toggleThemeButton" class="cv-button">Alterar Tema</button></li>
                <li><button id="goProfileButton" class="cv-button">Gerenciar Perfil</button></li>
                <li><button id="userLogoutButton" class="cv-button">Logout</button></li>
            </ul>
            </div>
        </div>
    </div>
    <main class="cv-container ocorrencias-main">
        <div class="ocorrencias-main__header">
            <h1>Minhas Ocorrências</h1>
            <button id="btnNovaOcorrencia" class="cv-button cv-button--primary ocorrencias-main__nova-button">+ Nova Ocorrência</button>
        </div>

        <div class="cv-tabs ocorrencias-tabs">
            <button class="cv-tabs__button cv-tabs__button--active" data-tab-filter="minhas">Minhas Ocorrências</button>
            <button class="cv-tabs__button" data-tab-filter="abertas">Em Aberto</button>
            <button class="cv-tabs__button" data-tab-filter="resolvidas">Resolvidas</button>
            <button class="cv-tabs__button" data-tab-filter="todas" id="tabTodasOcorrencias" style="display:none;">Todas</button>
        </div>

        <div id="listaOcorrencias" class="card-grid ocorrencias-lista">
            <!-- Ocorrência cards serão inseridos aqui via JS -->
        </div>
        <div id="ocorrenciasSkeletonContainer" class="card-grid ocorrencias-lista feed-skeleton-container" style="display:none;">
            <div class="cv-card ocorrencia-card skeleton-item">
                <div class="ocorrencia-card__header">
                    <h3 class="skeleton-block skeleton-title" style="width: 70%; height: 24px; margin-bottom: 8px;"></h3>
                    <span class="skeleton-block skeleton-tag" style="width: 80px; height: 20px;"></button>
                </div>
                <p class="skeleton-block skeleton-line" style="width: 50%; margin-top: 12px;"></p>
                <p class="skeleton-block skeleton-line" style="width: 60%;"></p>
                <p class="skeleton-block skeleton-line" style="width: 80%;"></p>
                <p class="skeleton-block skeleton-line" style="width: 75%;"></p>
            </div>
            <div class="cv-card ocorrencia-card skeleton-item">
                <div class="ocorrencia-card__header">
                    <h3 class="skeleton-block skeleton-title" style="width: 60%; height: 24px; margin-bottom: 8px;"></h3>
                    <span class="skeleton-block skeleton-tag" style="width: 70px; height: 20px;"></button>
                </div>
                <p class="skeleton-block skeleton-line" style="width: 45%; margin-top: 12px;"></p>
                <p class="skeleton-block skeleton-line" style="width: 55%;"></p>
                <p class="skeleton-block skeleton-line" style="width: 70%;"></p>
                <p class="skeleton-block skeleton-line" style="width: 65%;"></p>
            </div>
            <div class="cv-card ocorrencia-card skeleton-item">
                <div class="ocorrencia-card__header">
                    <h3 class="skeleton-block skeleton-title" style="width: 75%; height: 24px; margin-bottom: 8px;"></h3>
                    <span class="skeleton-block skeleton-tag" style="width: 90px; height: 20px;"></button>
                </div>
                <p class="skeleton-block skeleton-line" style="width: 55%; margin-top: 12px;"></p>
                <p class="skeleton-block skeleton-line" style="width: 65%;"></p>
                <p class="skeleton-block skeleton-line" style="width: 85%;"></p>
                <p class="skeleton-block skeleton-line" style="width: 70%;"></p>
            </div>
        </div>
        <p id="ocorrenciasLoading" class="loading-text" style="display:none;">Carregando ocorrências...</p> <!-- Hide by default now -->
        <p id="noOcorrenciasMessage" class="info-text" style="display:none;">Nenhuma ocorrência encontrada.</p>

        <div class="ocorrencias-load-more__container" id="loadMoreContainer" style="display:none; text-align: center; margin-top: 20px; margin-bottom: 20px;">
            <button id="btnCarregarMaisOcorrencias" class="cv-button cv-button--secondary">Carregar Mais</button>
        </div>
    </main>

    <!-- Modal de Cadastro de Nova Ocorrência -->
    <div id="modalNovaOcorrencia" class="cv-modal" style="display:none;">
        <div class="cv-modal-content cv-modal-content--padded"> <!-- Padronizado -->
            <button type="button" class="cv-modal-close" aria-label="Fechar" id="closeNovaOcorrenciaModal">&times;</button> <!-- Padronizado -->
            <h2>Nova Ocorrência</h2>
            <form id="formNovaOcorrencia" class="cv-form">
                <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="ocorrenciaTitulo">Título (obrigatório):</label> <!-- Removido cv-form__label, assumindo estilo global para label dentro de cv-form-group -->
                    <input type="text" id="ocorrenciaTitulo" name="titulo" class="cv-input" required maxlength="100"> <!-- Padronizado -->
                </div>
                <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="ocorrenciaDescricao">Descrição (obrigatório):</label>
                    <textarea id="ocorrenciaDescricao" name="descricao" class="cv-input" rows="5" required maxlength="1000"></textarea> <!-- Padronizado -->
                </div>
                <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="ocorrenciaCategoria">Categoria (obrigatório):</label>
                    <select id="ocorrenciaCategoria" name="categoria" class="cv-input" required> <!-- Padronizado -->
                        <option value="">Selecione...</option>
                        <!-- Options serão populadas pelo JS -->
                    </select>
                </div>
                <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="ocorrenciaPrioridade">Prioridade:</label>
                    <select id="ocorrenciaPrioridade" name="prioridade" class="cv-input"> <!-- Padronizado -->
                        <option value="NORMAL">Normal</option>
                        <option value="URGENTE">Urgente</option>
                    </select>
                </div>
                <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="ocorrenciaAnexos">Anexos (opcional, máx 10MB por arquivo):</label>
                    <input type="file" id="ocorrenciaAnexos" name="anexos" class="cv-input" multiple accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx,.txt,.aac,.mp3,.wav"> <!-- Padronizado -->
                    <div id="anexosPreviewContainer" class="anexos-preview"></div>
                </div>
                <div id="formNovaOcorrenciaErrors" class="cv-alert cv-alert--error" style="display:none;"></div> <!-- Padronizado para cv-alert -->
                <div class="cv-form-actions"> <!-- Padronizado -->
                    <button type="button" id="cancelNovaOcorrencia" class="cv-button cv-button--secondary">Cancelar</button>
                    <button type="submit" class="cv-button cv-button--primary">Enviar Ocorrência</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Detalhe da Ocorrência -->
    <div id="modalDetalheOcorrencia" class="cv-modal" style="display:none;">
        <div class="cv-modal-content cv-modal-content--large cv-modal-content--padded"> <!-- Padronizado, mantendo --large se for uma variação válida -->
            <button type="button" class="cv-modal-close" aria-label="Fechar" id="closeDetalheOcorrenciaModal">&times;</button> <!-- Padronizado -->

            <div id="detalheOcorrenciaSkeleton" class="feed-skeleton-container" style="display:none; padding-bottom: 20px;">
                <div class="skeleton-block skeleton-title" style="width: 60%; height: 28px; margin-bottom: 20px;"></div>
                <div class="ocorrencia-detalhes-grid">
                    <p><strong class="skeleton-block skeleton-line--short" style="width:80px; height:1em; display:inline-block; margin-right: 5px;"></strong> <span class="skeleton-block skeleton-line--medium" style="width:120px; height:1em; display:inline-block;"></button></p>
                    <p><strong class="skeleton-block skeleton-line--short" style="width:70px; height:1em; display:inline-block; margin-right: 5px;"></strong> <span class="skeleton-block skeleton-line--medium" style="width:100px; height:1em; display:inline-block;"></button></p>
                    <p><strong class="skeleton-block skeleton-line--short" style="width:90px; height:1em; display:inline-block; margin-right: 5px;"></strong> <span class="skeleton-block skeleton-line--medium" style="width:80px; height:1em; display:inline-block;"></button></p>
                    <p><strong class="skeleton-block skeleton-line--short" style="width:100px; height:1em; display:inline-block; margin-right: 5px;"></strong> <span class="skeleton-block skeleton-line--medium" style="width:150px; height:1em; display:inline-block;"></button></p>
                    <p><strong class="skeleton-block skeleton-line--short" style="width:110px; height:1em; display:inline-block; margin-right: 5px;"></strong> <span class="skeleton-block skeleton-line--medium" style="width:140px; height:1em; display:inline-block;"></button></p>
                    <p><strong class="skeleton-block skeleton-line--short" style="width:90px; height:1em; display:inline-block; margin-right: 5px;"></strong> <span class="skeleton-block skeleton-line--medium" style="width:160px; height:1em; display:inline-block;"></button></p>
                </div>
                <h3 class="skeleton-block skeleton-subtitle" style="width: 30%; margin-top: 20px; height: 20px;"></h3>
                <p class="skeleton-block skeleton-line" style="margin-top: 8px;"></p>
                <p class="skeleton-block skeleton-line skeleton-line--long" style="width: 80%;"></p>

                <h3 class="skeleton-block skeleton-subtitle" style="width: 25%; margin-top: 20px; height: 20px;"></h3>
                <div class="skeleton-block skeleton-line" style="height: 40px; margin-top: 8px;"></div>

                <h3 class="skeleton-block skeleton-subtitle" style="width: 35%; margin-top: 20px; height: 20px;"></h3>
                <div class="skeleton-block skeleton-line" style="height: 30px; margin-top: 8px;"></div>
                <div class="skeleton-block skeleton-line" style="height: 30px; margin-top: 8px;"></div>

                <h3 class="skeleton-block skeleton-subtitle" style="width: 30%; margin-top: 20px; height: 20px;"></h3>
                <div class="skeleton-block skeleton-line" style="height: 30px; margin-top: 8px;"></div>
                <div class="skeleton-block skeleton-line" style="height: 30px; margin-top: 8px;"></div>
            </div>

            <div id="detalheOcorrenciaContentLoaded" style="display:none;">
                <h2 id="detalheTitulo"></h2>
                <div class="ocorrencia-detalhes-grid">
                    <p><strong>Categoria:</strong> <span id="detalheCategoria"></button></p>
                    <p><strong>Status Atual:</strong> <span id="detalheStatus" class="status-tag"></button></p>
                    <p><strong>Prioridade:</strong> <span id="detalhePrioridade"></button></p>
                    <p><strong>Data de Abertura:</strong> <span id="detalheDataAbertura"></button></p>
                    <p><strong>Última Atualização:</strong> <span id="detalheDataAtualizacao"></button></p>
                    <p><strong>Aberta por:</strong> <span id="detalheUsuarioNome"></button> (<span id="detalheUsuarioUnidade"></button>)</p>
                </div>

                <h3>Descrição:</h3>
                <p id="detalheDescricao" class="ocorrencia-descricao-detalhe"></p>

                <h3>Anexos:</h3>
                <div id="detalheAnexosContainer" class="anexos-container">
                    <!-- Anexos serão listados aqui -->
                </div>
                 <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="detalheNovosAnexos">Adicionar mais anexos (opcional):</label>
                    <input type="file" id="detalheNovosAnexos" name="novosAnexos" class="cv-input" multiple accept="image/*,application/pdf,.doc,.docx,.xls,.xlsx,.txt,.aac,.mp3,.wav"> <!-- Padronizado -->
                    <button id="btnAdicionarNovosAnexos" class="cv-button cv-button--secondary cv-button--small">Adicionar Selecionados</button>
                    <div id="novosAnexosPreviewContainer" class="anexos-preview"></div>
                </div>

                <h3>Histórico de Status:</h3>
                <ul id="detalheHistoricoStatus" class="historico-status-lista">
                    <!-- Histórico será listado aqui -->
                </ul>

                <h3>Comentários:</h3>
                <div id="detalheComentariosContainer" class="comentarios-container">
                    <!-- Comentários serão listados aqui -->
                </div>

                <div id="comentarioFormContainer" class="cv-form">
                    <h4>Adicionar Comentário:</h4>
                    <textarea id="novoComentarioTexto" class="cv-input" rows="3" placeholder="Digite seu comentário..."></textarea> <!-- Padronizado -->
                    <div id="formComentarioErrors" class="cv-alert cv-alert--error" style="display:none;"></div> <!-- Padronizado para cv-alert -->
                    <button id="btnAdicionarComentario" class="cv-button cv-button--primary">Adicionar Comentário</button>
                </div>

                <div class="cv-form-actions ocorrencia-detalhes__actions"> <!-- Padronizado para cv-form-actions -->
                    <button id="btnAlterarStatus" class="cv-button cv-button--secondary" style="display:none;">Alterar Status</button>
                    <button id="btnExcluirOcorrencia" class="cv-button cv-button--danger" style="display:none;">Excluir Ocorrência</button>
                </div>
            </div> <!-- Fim de detalheOcorrenciaContentLoaded -->
        </div>
    </div>

    <!-- Modal para Alterar Status -->
    <div id="modalAlterarStatus" class="cv-modal" style="display:none;">
        <div class="cv-modal-content cv-modal-content--padded"> <!-- Padronizado -->
            <button type="button" class="cv-modal-close" aria-label="Fechar" id="closeAlterarStatusModal">&times;</button> <!-- Padronizado -->
            <h2>Alterar Status da Ocorrência</h2>
            <form id="formAlterarStatus" class="cv-form">
                <input type="hidden" id="ocorrenciaIdParaAlterarStatus">
                <div class="cv-form-group"> <!-- Padronizado -->
                    <label for="selectNovoStatus">Novo Status:</label>
                    <select id="selectNovoStatus" class="cv-input"> <!-- Padronizado -->
                        <option value="ABERTA">Aberta</option>
                        <option value="EM_ANALISE">Em Análise</option>
                        <option value="EM_ATENDIMENTO">Em Atendimento</option>
                        <option value="RESOLVIDA">Resolvida</option>
                        <option value="CANCELADA">Cancelada</option>
                    </select>
                </div>
                <div id="formAlterarStatusErrors" class="cv-alert cv-alert--error" style="display:none;"></div> <!-- Padronizado para cv-alert -->
                <button type="submit" class="cv-button cv-button--primary">Salvar Status</button>
            </form>
        </div>
    </div>

    <footer class="cv-footer">
        <p>&copy; 2024 conViver. Todos os direitos reservados.</p>
    </footer>

    <script src="../js/config.js"></script>
    <script type="module" src="../js/nav.js"></script>
    <script type="module" src="../js/userMenu.js"></script>
    <script src="../js/apiClient.js" type="module"></script>
    <script src="../js/auth.js" type="module"></script>
    <script src="../js/ocorrencias.js" type="module"></script>
    <!-- <script src="../js/main.js" type="module"></script> -->
</body>

</html>
